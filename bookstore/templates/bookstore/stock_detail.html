{% extends 'bookstore/base_bookstore.html' %}

{% block title %}도서 재고 상세 정보{% endblock %}

{% load humanize %}

{% block bookstore_content %}

<div class="max-w-3xl mx-auto bg-white shadow rounded-lg p-6">
    <h1 class="text-2xl font-semibold text-gray-900 mb-6">도서 재고 상세 정보</h1>

    <div class="grid grid-cols-1 gap-6">
        <div>
            <label for="book_name" class="block text-sm font-medium text-gray-700">
                도서명
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.book.name }}</span>
        </div>
        <div>
            <label for="quantity" class="block text-sm font-medium text-gray-700">
                수량
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.quantity }}</span>
        </div>
        <div>
            <label for="list_price" class="block text-sm font-medium text-gray-700">
                정가
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.list_price|floatformat:0|intcomma }}</span>
        </div>
        <div>
            <label for="unit_price" class="block text-sm font-medium text-gray-700">
                단가
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.unit_price|floatformat:0|intcomma }}</span>
        </div>
        <div>
            <label for="selling_price" class="block text-sm font-medium text-gray-700">
                판매가
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.selling_price|floatformat:0|intcomma }}</span>
        </div>
        <div>
            <label for="received_date" class="block text-sm font-medium text-gray-700">
                입고일
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.received_date|date:"Y-m-d" }}</span>
        </div>
        <div>
            <label for="notes" class="block text-sm font-medium text-gray-700">
                메모
            </label>
            <span class="mt-1 block text-sm text-gray-900">{{ stock.notes }}</span>
        </div>
    </div>

    <div class="flex justify-end mt-6">
        {% if stock.quantity > 0 %}
            <a href="{% url 'bookstore:stock_return' stock_id=stock.id %}" 
               class="form-button bg-red-500 hover:bg-red-600">
                반품
            </a>
        {% else %}
            <button onclick="showNoStockMessage()" 
                    class="form-button bg-gray-400 cursor-not-allowed">
                반품
            </button>
        {% endif %}
    </div>
</div>

<!-- 동일 교재 다른 입고 정보 -->
{% if related_stocks %}
<div class="max-w-3xl mx-auto bg-white shadow rounded-lg p-6 mt-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-4">동일 교재 다른 입고 정보</h2>
    
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">입고일</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">수량</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">정가</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">단가</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">판매가</th>
                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">관리</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for related_stock in related_stocks %}
                <tr>
                    <td class="px-4 py-3 whitespace-nowrap">{{ related_stock.received_date|date:"Y-m-d" }}</td>
                    <td class="px-4 py-3 text-right whitespace-nowrap">{{ related_stock.quantity }}</td>
                    <td class="px-4 py-3 text-right whitespace-nowrap">{{ related_stock.list_price|floatformat:0|intcomma }}</td>
                    <td class="px-4 py-3 text-right whitespace-nowrap">{{ related_stock.unit_price|floatformat:0|intcomma }}</td>
                    <td class="px-4 py-3 text-right whitespace-nowrap">{{ related_stock.selling_price|floatformat:0|intcomma }}</td>
                    <td class="px-4 py-3 text-center whitespace-nowrap">
                        <div class="flex justify-center space-x-2">
                            {% if related_stock.quantity > 0 %}
                            <a href="{% url 'bookstore:stock_return' stock_id=related_stock.id %}" 
                               class="text-sm bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-2 rounded">
                                반품
                            </a>
                            {% endif %}
                            <a href="{% url 'bookstore:stock_update' pk=related_stock.id %}" 
                               class="text-sm bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded">
                                수정
                            </a>
                            <a href="{% url 'bookstore:stock_delete' pk=related_stock.id %}" 
                               class="text-sm bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded"
                               onclick="return confirm('정말로 이 정보를 삭제하시겠습니까?');">
                                삭제
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<script>
function showNoStockMessage() {
    alert('반품할 재고가 없습니다!');
}
</script>

{% endblock %}
